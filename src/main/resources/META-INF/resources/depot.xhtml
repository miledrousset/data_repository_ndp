<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>GT Numérique</title>
    <meta content="Interface de dépôt destinée aux membres du chantier scientifique de Notre-Dame" name="description"/>
    <meta content="" name="keywords"/>

    <!-- Favicons -->
    <link href="assets/img/favicon.png" rel="icon"/>
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon"/>

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="assets/css/icofont.min.css" rel="stylesheet"/>
    <link href="assets/css/animate.min.css" rel="stylesheet"/>
    <link href="assets/css/style.css" rel="stylesheet"/>
    <link href="assets/css/tableau.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

    <!-- JS Files -->
    <script src="assets/js/validate.js"></script>
    <script src="assets/js/isotope.pkgd.min.js"></script>
</h:head>

<h:body style="background: #FFFFFF">
    <p:growl id="messages" showDetail="true" />

    <ui:include src="header.xhtml"/>


    <main id="main">
        <section id="breadcrumbs" class="breadcrumbs">
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <h2>Dépôt de donnée</h2>
                    <ol>
                        <li><a href="index.xhtml">Accueil</a></li>
                        <li>Dépôt de donnée</li>
                    </ol>
                </div>

            </div>
        </section>

        <ui:include src="composant_connexion.xhtml"/>

        <h:panelGroup id="mainDepos" rendered="#{connexionBean.isUserConnected}">
            <h:form>
                <section id="blog" class="blog">
                    <div class="container">
                        <div class="col-lg-12 entries">

                            <div class="blog-comments">
                                <div class="reply-form" style="background-color: #FFFFFF">
                                    <h1>Chargement du formulaire de dépôt de métadonnées</h1>
                                    <p style="font-size: 14px;">Veuillez sélectionner un schéma dans la liste</p>
                                    <b:selectOneMenu value="#{dataDepotManager.schemasSelected}"
                                                     style="width:100%; font-size: 14px;"
                                                     disabled="#{dataDepotManager.detailDepotVisible}">
                                        <f:selectItem itemLabel="Deblin Core" itemValue="1"/>
                                        <f:selectItem itemLabel="Article de Press (gt-Emotion)" itemValue="2" />
                                        <f:selectItem itemLabel="URL" itemValue="3" />
                                        <f:selectItem itemLabel="Vidéo" itemValue="4" />
                                        <f:selectItem itemLabel="Image (LRMH)" itemValue="5" />
                                        <f:selectItem itemLabel="Audio Wawe BWF" itemValue="6" />
                                        <f:selectItem itemLabel="Données laser brutes (stations)" itemValue="7" />
                                        <f:selectItem itemLabel="Données Laser Conso. (nuage)" itemValue="8" />
                                        <f:selectItem itemLabel="Nuage de points photogrammétrie" itemValue="9" />
                                        <f:selectItem itemLabel="Maillage 3D photogrammétrie" itemValue="10" />
                                        <f:selectItem itemLabel="Restitution 3D Geometry" itemValue="11" />
                                    </b:selectOneMenu>

                                    <div class="modal-footer">
                                        <b:commandButton value="Valider" actionListener="#{dataDepotManager.onValiderSchema()}"
                                                         disabled="#{dataDepotManager.detailDepotVisible}" update="mainDepos"
                                                         class="btn btn-success" ajax="true"/>
                                    </div>
                                </div>
                            </div>

                            <h:panelGroup rendered="#{dataDepotManager.detailDepotVisible}">
                                <div class="blog-comments">
                                    <div class="reply-form" style="background-color: #FFFFFF">
                                        <div class="form-group row">
                                            <h:outputText class="col-sm-2 col-form-label" style="font-size: 14px" value="Groupe de travail :" />
                                            <div class="col-sm-10">
                                                <b:selectOneMenu value="#{dataDepotManager.groupeTravailSelected}" style="width:100%; font-size: 14px;" dynamic="true"
                                                                 disabled="#{dataDepotManager.uploadFilesVisible}">
                                                    <f:selectItems value="#{dataDepotManager.groupeTravail}" var="groupe" itemLabel="#{groupe}" itemValue="#{groupe}" />
                                                </b:selectOneMenu>
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <h:outputText class="col-sm-2 col-form-label" style="font-size: 14px" value="Repertoire :" />
                                            <div class="col-sm-10">
                                                <b:selectOneMenu value="#{dataDepotManager.repertoirSelected}" style="width:100%; font-size: 14px;" dynamic="true"
                                                                 disabled="#{dataDepotManager.uploadFilesVisible}">
                                                    <f:selectItems value="#{dataDepotManager.repertoireList}" var="repertoire" itemLabel="#{repertoire}" itemValue="#{repertoire}" />
                                                </b:selectOneMenu>
                                            </div>
                                        </div>

                                        <p style="font-size: 14px;">Chargement du métadata</p>
                                        <div class="input-group">
                                            <h:form style="width: 100%">
                                                <p:fileUpload fileUploadListener="#{dataDepotManager.uploadMetadonneFile}"
                                                              disabled="#{dataDepotManager.uploadFilesVisible}"
                                                              style="width:100%; font-size: 12px;"
                                                              mode="advanced"
                                                              dragDropSupport="true"
                                                              multiple="false"
                                                              cancelIcon="true" />
                                                <p>Nombre total des metadonnées chargés : <B>#{dataDepotManager.listMetadonnes.size()}</B></p>
                                            </h:form>
                                        </div>

                                        <div class="modal-footer">
                                            <b:commandButton value="Valider" actionListener="#{dataDepotManager.onValiderUploadParams()}"
                                                             disabled="#{dataDepotManager.uploadFilesVisible}"
                                                             class="btn btn-success" update="mainDepos" ajax="true"/>
                                        </div>
                                    </div>
                                </div>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{dataDepotManager.uploadFilesVisible}">
                                <div class="blog-comments">
                                    <div class="reply-form" style="background-color: #FFFFFF">
                                        <h1>Chargement des resources</h1>
                                        <p style="font-size: 14px;">Veuillez sélectionner le(s) fichier(s) que vous voullez uploader</p>
                                        <div class="input-group">
                                            <h:form style="width: 100%">
                                                <h:form>
                                                    <p:fileUpload fileUploadListener="#{dataDepotManager.uploadFiles}"
                                                                  mode="advanced"
                                                                  dragDropSupport="true"
                                                                  sizeLimit="1000000" fileLimit="3"
                                                                  allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
                                                </h:form>
                                            </h:form>
                                        </div>
                                    </div>
                                </div>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{dataDepotManager.uploadFilesVisible}">
                                <article class="entry entry-single" style="background-color: #FFFFFF" >
                                    <div class="container-xl">
                                        <div class="table-responsive">
                                            <div class="table-wrapper">
                                                <div class="table-title">
                                                    <div class="row">
                                                        <div class="col-sm-6">
                                                            <h2>Gestion des resources <b>#{dataDepotManager.depotName}</b></h2>
                                                        </div>
                                                        <div class="col-sm-6">
                                                            <a href="#deleteDebianCoreResource" class="btn btn-danger" data-toggle="modal">
                                                                <i class="material-icons">&#xE15C;</i>
                                                                <span>Supprimer</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <table id="resourceArray" class="table table-striped table-hover">
                                                    <thead>
                                                    <tr>
                                                        <th>
                                                            <span class="custom-checkbox"/>
                                                        </th>
                                                        <th >Titre</th>
                                                        <th>Créateur</th>
                                                        <th>Type</th>
                                                        <th>Format</th>
                                                        <th>Action</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <ui:repeat value="#{dataDepotManager.deblinCoreUploated}" var="res">
                                                        <tr>
                                                            <td>
                                                                <span class="custom-checkbox">
                                                                    <p:selectBooleanCheckbox value="#{res.selected}"/>
                                                                </span>
                                                            </td>
                                                            <td><h:outputText value="#{res.titre}"/></td>
                                                            <td><h:outputText value="#{res.createur}"/></td>
                                                            <td><h:outputText value="#{res.type}"/></td>
                                                            <td><h:outputText value="#{res.format}"/></td>
                                                            <td>
                                                                <p:commandButton icon="pi pi-save" title="Editer la resource"
                                                                                 oncomplete="#{dataDepotManager.afficherModifierResourceDialog()}"
                                                                                 actionListener="#{dataDepotManager.setResourceSelected(res)}"
                                                                                 ajax="true" update="mainDepos" style="color: #556270;"/>

                                                                <p:commandButton icon="fa-remove" title="Supprimer resource"
                                                                                 oncomplete="PF('supprimerdeblinCore').show();" style="color: #d9232d;"
                                                                                 actionListener="#{dataDepotManager.setResourceName(res.file.name)}"
                                                                                 ajax="true" update="mainDepos"/>
                                                            </td>
                                                        </tr>
                                                    </ui:repeat>
                                                    </tbody>
                                                </table>
                                                <div class="clearfix">
                                                    <div class="hint-text">Nombre des resources : <b>#{dataDepotManager.deblinCoreUploated.size()}</b></div>
                                                </div>
                                            </div>

                                            <div class="modal-footer">

                                                <p:commandButton value="Annuler" action="#{dataDepotManager.annulerDepot()}">
                                                    <p:confirm header="Confirmation" message="Voulez vous vraiment annuler ce dépôt ?"
                                                               icon="pi pi-exclamation-triangle" />
                                                </p:commandButton>
                                                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                                    <p:commandButton value="Oui" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                                                    <p:commandButton value="Non" type="button" styleClass="ui-confirmdialog-no" icon="pi pi-times" />
                                                </p:confirmDialog>

                                                <b:commandButton value="Valider" actionListener="#{dataDepotManager.validerDepot()}"
                                                                 class="get-started-btn ml-auto" update="mainDepos"/>
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            </h:panelGroup>
                        </div>
                    </div>
                </section>


                <ui:include src="/depot/url.xhtml"/>
                <ui:include src="/depot/video.xhtml"/>
                <ui:include src="/depot/image.xhtml"/>
                <ui:include src="/depot/audio.xhtml"/>
                <ui:include src="/depot/deblinCore.xhtml"/>
                <ui:include src="/depot/articlePress.xhtml"/>
                <ui:include src="/depot/supprimerResouce.xhtml"/>
                <ui:include src="/depot/donneesLaserConso.xhtml"/>
                <ui:include src="/depot/donneesLaserBrutes.xhtml"/>
                <ui:include src="/depot/maillage3dGeommetry.xhtml"/>
                <ui:include src="/depot/maillage3dPhotogrammetrice.xhtml"/>
                <ui:include src="/depot/nuagePointsPhotogrammetrie.xhtml"/>

            </h:form>
        </h:panelGroup>
    </main>

    <ui:include src="footer.xhtml"/>
</h:body>
</html>